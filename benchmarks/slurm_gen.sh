#!/bin/bash

#MPI_PROCS=2
#THREADS=12
#TIME=12:00:00
#OUTPUT_BASENAME="hybrid"
#SLURM_FILE_BASE="base.slurm"
#NAME="QSW_MPI"

NAME=$1
MPI_PROCS=$2
THREADS=$3
TIME=$4
TIME_SECONDS=$5
OUTPUT_BASENAME=$6
SLURM_FILE_BASE=$7
TEST_PROGRAM=$8
ACCOUNT=$9

NODES=(1 2 3 4 5 6 7 8 9 10 11 12 13 14 15)

mkdir -p ${OUTPUT_BASENAME}/output

for NODE in ${NODES[@]}; do
    SCRIPT_PATHNAME=${OUTPUT_BASENAME}/${NODE}_${OUTPUT_BASENAME}.slurm
    TOTAL_MPI_PROCS=$(($NODE * $MPI_PROCS))
    cp $SLURM_FILE_BASE $SCRIPT_PATHNAME
	  sed -i "s/TIME_PLACEHOLDER/$TIME/g" $SCRIPT_PATHNAME
	  sed -i "s/OUTPUT_PLACEHOLDER/output\/${NODE}_${OUTPUT_BASENAME}.out/g" $SCRIPT_PATHNAME
	  sed -i "s/THREADS_PLACEHOLDER/$THREADS/g" $SCRIPT_PATHNAME
	  sed -i "s/NODES_PLACEHOLDER/$NODE/g" $SCRIPT_PATHNAME
	  sed -i "s/MPI_PROCS_PLACEHOLDER/$TOTAL_MPI_PROCS/g" $SCRIPT_PATHNAME
	  sed -i "s/RESULTS_PLACEHOLDER_LINE/\"output\/${NODE}_${OUTPUT_BASENAME}_line\"/g" $SCRIPT_PATHNAME
	  sed -i "s/CSV_PLACEHOLDER/\"output\/${NODE}_${OUTPUT_BASENAME}.csv\"/g" $SCRIPT_PATHNAME
	  sed -i "s/TEST_PROGRAM_PLACEHOLDER/$TEST_PROGRAM/g" $SCRIPT_PATHNAME
	  sed -i "s/NAME_PLACEHOLDER/$NAME/g" $SCRIPT_PATHNAME
	  sed -i "s/ACCOUNT_PLACEHOLDER/$ACCOUNT/g" $SCRIPT_PATHNAME
done
